(swoosh) - [Voiceover] We're ready for challenge assignment. In this challenge, you will use what we've learned in this chapter to create the migrations we need for our content management system. First, let me give you an idea of the structure that I have in mind for the content management system. Let's begin by looking at a sample layout for what I think a page will look like. That is the content that will be displayed to the public. There's going to be a navigation on the left which shows the available pages of content grouped by their subject. We can click on any page name and it will take us to that page.

The content of each page will be displayed on the right. Each page will be composed of several sections. In my example, we're looking at page three and we see that there are three sections of content. The hierarchy is subject, page, section. Another way to diagram it would be like this. A subject has several pages and then a page has several sections. This concept where we have many objects that belong to another object is common with relational databases. We call it a one to many relationship.

We'll look at it in more depth in a moment. In order for this to work, the pages table will need a foreign key to help it keep track of which subject it belongs to. We talked about foreign keys in the introduction. In rails, we would name this key subject, underscore, id. That's the default that rails would expect. The name is made up of the singular form of the foreign table plus underscore, id. The sections will need a page id column to track which page is it's parent page. Both subject id and page id will be integer columns.

Here are the objectives for the assignment. First, start by generating the models we're gonna need. You'll want one for subject, page, and section. Remember, when you generate a model a migration file is generated at the same time. Then, you'll need to write the migrations. For subjects, you're gonna have columns for name, that's gonna be the name that will appear in the left navigation, position, which will determine in which order those names should appear, visible, to determine whether the page is visible to the public or whether it should be hidden.

For pages, we're going to have that foreign key that we just talked about, subject, underscore, id and that's going to be an integer. Then we'll have name and permalink. The permalink will be used as a URL to refer to this page so that we can look up the page directly. Instead of referring to a page's id number five, we'll be able to give that a nice, readable, and search engine friendly URL. And then we'll also have position and visible for each of the pages. Next, we'll have sections, we'll have page id which is that foreign key that we just talked about which will be of type integer.

We'll have a name and a position and visible. And then we'll have content type saying what kind of content will go in this section. And then content which will hold the content of the page itself. That goes in a text column because this information can be quite long. It won't fit in a simple string column. We need a longer text column for it. That's really the difference between string and text is that string is limited while text is unlimited. Don't forget to add indexes to the appropriate columns. The rule is that all foreign keys and all columns used for looking up a record will need indexes.

I'll give you a hint. I would add in three additional indexes and none of those three would be on the subjects' table. See if you can find where those three go. The last step is going to be to run your migrations. Run the up method to migrate up and then try the down method to make sure it also works. Try going all the way up and then try moving all the way down. Move between different versions to get a feel for how those work. And when you're done make sure you migrate all the way back up so that your database will be in the same state as mine. This challenge should take about 20 to 30 minutes to complete.

Refer back to movies in this chapter if you get stuck. When you're done, be sure to watch the solution video where I show the solution that I came up with. Good luck.
